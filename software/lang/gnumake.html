

<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="">
    
    
      
        <title>GNU Make Coding Guide - Jan Matějka</title>
      
    
    
      
        
        
      
      

    
    
    
      
        
        
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
        <link rel="stylesheet" type="text/css" href="../../_static/matejka.css" />
        <link rel="stylesheet" type="text/css" href="../../_static/sphinx_immaterial_theme.07b60405deca57041.min.css" />
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-HBSC0RW1T5"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-HBSC0RW1T5",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-HBSC0RW1T5",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>

  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#getting-started" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../index.html" title="Jan Matějka" class="md-header__button md-logo" aria-label="Jan Matějka" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>
    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Jan Matějka
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              GNU Make Coding Guide
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../index.html" title="Jan Matějka" class="md-nav__button md-logo" aria-label="Jan Matějka" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>
    </a>
    Jan Matějka
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../about.html" class="md-nav__link">
        <span class="md-ellipsis">About</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../../links.html" class="md-nav__link">
        <span class="md-ellipsis">Links</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../argv.html" class="md-nav__link">
        <span class="md-ellipsis">The Ultimate Guide to Argv</span>
      </a>
    </li>
  

    
      
      
      

  
  
    
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          <span class="md-ellipsis">GNU Make Coding Guide</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="#" class="md-nav__link md-nav__link--active">
        <span class="md-ellipsis">GNU Make Coding Guide</span>
      </a>
      
        

<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    <span title="software/lang/gnumake:getting started (reference label)" class="md-ellipsis">Getting Started</span>
  </a>
  
    <nav class="md-nav" aria-label="Getting Started">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#source-structure" class="md-nav__link">
    <span title="software/lang/gnumake:source structure (reference label)" class="md-ellipsis">Source Structure</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-make" class="md-nav__link">
    <span title="software/lang/gnumake:using make (reference label)" class="md-ellipsis">Using Make</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makefile-name" class="md-nav__link">
    <span title="software/lang/gnumake:makefile name (reference label)" class="md-ellipsis">Makefile Name</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-recipe" class="md-nav__link">
    <span title="software/lang/gnumake:install recipe (reference label)" class="md-ellipsis">Install Recipe</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span title="software/lang/gnumake:best practices (reference label)" class="md-ellipsis">Best Practices</span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default-target" class="md-nav__link">
    <span title="software/lang/gnumake:default target (reference label)" class="md-ellipsis">Default Target</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-targets" class="md-nav__link">
    <span title="software/lang/gnumake:install targets (reference label)" class="md-ellipsis">Install Targets</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#directories" class="md-nav__link">
    <span title="software/lang/gnumake:directories (reference label)" class="md-ellipsis">Directories</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-uses" class="md-nav__link">
    <span title="software/lang/gnumake:example uses (reference label)" class="md-ellipsis">Example Uses</span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="zsh.html" class="md-nav__link">
        <span class="md-ellipsis">Zsh Scripting Guide</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="bash.html" class="md-nav__link">
        <span class="md-ellipsis">Shell Scripting Survival Guide</span>
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    <span title="software/lang/gnumake:getting started (reference label)" class="md-ellipsis">Getting Started</span>
  </a>
  
    <nav class="md-nav" aria-label="Getting Started">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#source-structure" class="md-nav__link">
    <span title="software/lang/gnumake:source structure (reference label)" class="md-ellipsis">Source Structure</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-make" class="md-nav__link">
    <span title="software/lang/gnumake:using make (reference label)" class="md-ellipsis">Using Make</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#makefile-name" class="md-nav__link">
    <span title="software/lang/gnumake:makefile name (reference label)" class="md-ellipsis">Makefile Name</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-recipe" class="md-nav__link">
    <span title="software/lang/gnumake:install recipe (reference label)" class="md-ellipsis">Install Recipe</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span title="software/lang/gnumake:best practices (reference label)" class="md-ellipsis">Best Practices</span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default-target" class="md-nav__link">
    <span title="software/lang/gnumake:default target (reference label)" class="md-ellipsis">Default Target</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-targets" class="md-nav__link">
    <span title="software/lang/gnumake:install targets (reference label)" class="md-ellipsis">Install Targets</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#directories" class="md-nav__link">
    <span title="software/lang/gnumake:directories (reference label)" class="md-ellipsis">Directories</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-uses" class="md-nav__link">
    <span title="software/lang/gnumake:example uses (reference label)" class="md-ellipsis">Example Uses</span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset" role="main">
                  


<h1 id="gnu-make-coding-guide"><a class="toc-backref" href="#id1">GNU Make Coding Guide</a><a class="headerlink" href="#gnu-make-coding-guide" title="Permalink to this heading">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#gnu-make-coding-guide" id="id1">GNU Make Coding Guide</a></p>
<ul>
<li><p><a class="reference internal" href="#getting-started" id="id2">Getting Started</a></p>
<ul>
<li><p><a class="reference internal" href="#source-structure" id="id3">Source Structure</a></p></li>
<li><p><a class="reference internal" href="#using-make" id="id4">Using Make</a></p></li>
<li><p><a class="reference internal" href="#makefile-name" id="id5">Makefile Name</a></p></li>
<li><p><a class="reference internal" href="#install-recipe" id="id6">Install Recipe</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#best-practices" id="id7">Best Practices</a></p>
<ul>
<li><p><a class="reference internal" href="#default-target" id="id8">Default Target</a></p></li>
<li><p><a class="reference internal" href="#install-targets" id="id9">Install Targets</a></p></li>
<li><p><a class="reference internal" href="#directories" id="id10">Directories</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#example-uses" id="id11">Example Uses</a></p></li>
</ul>
</li>
</ul>
</div>
<p>Make is a build automation software. GNU Make is GNU flavor of the Make.</p>
<p>It is simple, stable, and widely used de-facto standard of building and installing software on Linux
and UNIX systems. We will use it for build and installation of software written in languages that do
not provide builtin build and installation mechanism but it can be used with those
language/platforms as well.</p>
<p>The GNU Make website <a class="reference external" href="https://www.gnu.org/software/make/">https://www.gnu.org/software/make/</a> contains an extensive documentation you
normally refer to. This goal of this document is to give you only a limited quick getting started
introduction and exposure to some of the best practice for writing makefiles.</p>
<div class="tip admonition">
<p class="admonition-title">Tip</p>
<p><a class="reference external" href="https://nullprogram.com/blog/2017/08/20/">A Tutorial on Portable Makefiles</a> by
<a class="reference external" href="https://nullprogram.com/">Chris Wellons</a> is also very nice. That article is more theory and
principles oriented while this guide is more of a lets get started quick so we can get on with
other things kind of thing.</p>
</div>
<h2 id="getting-started"><a class="toc-backref" href="#id2">Getting Started</a><a class="headerlink" href="#getting-started" title="Permalink to this heading">¶</a></h2>
<h3 id="source-structure"><a class="toc-backref" href="#id3">Source Structure</a><a class="headerlink" href="#source-structure" title="Permalink to this heading">¶</a></h3>
<p>Before we get to talk about the make itself we need to assume some source and installation
structure. For demonstration purposes we will assume a simple bash software as outlined in
<a class="reference internal" href="bash.html"><span class="doc">Shell Scripting Survival Guide</span></a>.</p>
<p>Source structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code>foo/
└── src/
    ├── foo.bash
    ├── foo_prelude.bash
    └── foo-subroutine.bash
</code></pre></div>
</div>
<p>Installation structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code>/bin/
├── foo
├── foo_prelude
└── foo-subroutine
</code></pre></div>
</div>
<h3 id="using-make"><a class="toc-backref" href="#id4">Using Make</a><a class="headerlink" href="#using-make" title="Permalink to this heading">¶</a></h3>
<p>Make is used by entering the project root and running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code>$ make &lt;target&gt;
</code></pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">target</span></code> typically being one of <code class="docutils literal notranslate"><span class="pre">all</span></code>, <code class="docutils literal notranslate"><span class="pre">build</span></code>, <code class="docutils literal notranslate"><span class="pre">install</span></code>, <code class="docutils literal notranslate"><span class="pre">check</span></code>. See
<a class="reference external" href="https://www.gnu.org/software/make/manual/html_node/Standard-Targets.html">https://www.gnu.org/software/make/manual/html_node/Standard-Targets.html</a>
for more about standard targets.</p>
<p><code class="docutils literal notranslate"><span class="pre">make</span></code> then reads Makefile from the current directory and executes recipe defining how to build the
<code class="docutils literal notranslate"><span class="pre">&lt;target&gt;</span></code>.</p>
<h3 id="makefile-name"><a class="toc-backref" href="#id5">Makefile Name</a><a class="headerlink" href="#makefile-name" title="Permalink to this heading">¶</a></h3>
<p>Makefile should be named <code class="docutils literal notranslate"><span class="pre">GNUmakefile</span></code> to indicate it is written for the GNU flavor of make.
Yielding new source structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code>foo
├── GNUmakefile
└── src
    ├── foo.bash
    ├── foo_prelude.bash
    └── foo-subroutine.bash
</code></pre></div>
</div>
<h3 id="install-recipe"><a class="toc-backref" href="#id6">Install Recipe</a><a class="headerlink" href="#install-recipe" title="Permalink to this heading">¶</a></h3>
<p>At its simplest, we do not need a build step and go straight to installing the software.</p>
<div class="highlight-make notranslate"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nv">src</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">$(</span>wildcard<span class="w"> </span>src/*.bash<span class="k">)</span>
<span class="nv">i_bin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">$(</span>patsubst<span class="w"> </span>src/%.bash,/usr/bin/%<span class="k">)</span>

<span class="nf">.PHONY</span><span class="o">:</span><span class="w"> </span><span class="n">install</span>
<span class="nf">install</span><span class="o">:</span><span class="w"> </span><span class="k">$(</span><span class="nv">i_bin</span><span class="k">)</span>

<span class="nf">/usr/bin/%</span><span class="o">:</span><span class="w"> </span><span class="n">src</span>/%.<span class="n">bash</span>

<span class="w">     </span>install<span class="w"> </span>-m755<span class="w"> </span>$&lt;<span class="w"> </span><span class="nv">$@</span>
</code></pre></div></td></tr></table></div>
</div>
<p>Running <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">install</span></code> will now install your bash scripts into executables at
<code class="docutils literal notranslate"><span class="pre">/usr/bin/foo</span></code>, <code class="docutils literal notranslate"><span class="pre">/usr/bin/foo_prelude</span></code>, and <code class="docutils literal notranslate"><span class="pre">foo-subroutine</span></code>.</p>
<p>How it works:</p>
<ul>
<li><p>Line 1 uses <a class="reference external" href="https://www.gnu.org/software/make/manual/html_node/Wildcard-Function.html">wildcard function</a> and <a class="reference external" href="https://www.gnu.org/software/make/manual/html_node/Setting.html#Setting">variable
assignment</a> to define
<code class="docutils literal notranslate"><span class="pre">src</span></code> - the list of source file paths relative to current directory.</p></li>
<li><p>Line 2 uses <a class="reference external" href="https://www.gnu.org/software/make/manual/html_node/Text-Functions.html">patsubst function</a> to translate the source
file path into the installation file paths.</p></li>
<li><p>Line 7 defines <code class="docutils literal notranslate"><span class="pre">/usr/bin/%</span></code> target as a pattern rule
<a class="reference external" href="https://www.gnu.org/software/make/manual/html_node/Pattern-Rules.html">https://www.gnu.org/software/make/manual/html_node/Pattern-Rules.html</a>
to depend on <code class="docutils literal notranslate"><span class="pre">src/%.bash</span></code> and
to be built by using <em class="manpage"><a class="manpage reference external" href="https://manpages.debian.org/install">install</a></em> and <a class="reference external" href="https://www.gnu.org/software/make/manual/html_node/Automatic-Variables.html">using automatic
variables</a>
<code class="docutils literal notranslate"><span class="pre">$&lt;</span></code> and <code class="docutils literal notranslate"><span class="pre">$&#64;</span></code> to refer to the target and source file paths.</p>
<p>Meaning any target of the form <code class="docutils literal notranslate"><span class="pre">/usr/bin/&lt;whatever&gt;</span></code> depends on <code class="docutils literal notranslate"><span class="pre">src/&lt;whatever&gt;.bash</span></code> and the
command to build the target is <code class="docutils literal notranslate"><span class="pre">install</span> <span class="pre">-m755</span> <span class="pre">src/&lt;whatever&gt;.bash</span> <span class="pre">/usr/bin/&lt;whatever&gt;</span></code>.</p>
<div class="note admonition">
<p class="admonition-title">Note</p>
<p>Targets are file paths</p>
</div>
<div class="note admonition">
<p class="admonition-title">Note</p>
<p>The recipe starts with a tab character. See
<a class="reference external" href="https://www.gnu.org/software/make/manual/html_node/Rule-Syntax.html#Rule-Syntax">https://www.gnu.org/software/make/manual/html_node/Rule-Syntax.html#Rule-Syntax</a></p>
</div>
</li>
<li><p>Line 5 defines the target <code class="docutils literal notranslate"><span class="pre">install</span></code> to depend on <code class="docutils literal notranslate"><span class="pre">$(i_bin)</span></code> targets. Meaning in order to
build <code class="docutils literal notranslate"><span class="pre">install</span></code> target, the <code class="docutils literal notranslate"><span class="pre">$(i_bin)</span></code> targets need to be built first.</p></li>
<li><p>Line 4 defines the <code class="docutils literal notranslate"><span class="pre">install</span></code> target as
<a class="reference external" href="https://www.gnu.org/software/make/manual/html_node/Phony-Targets.html">phony target</a>
to instruct make it is not actually supposed to build the file <code class="docutils literal notranslate"><span class="pre">install</span></code>.</p></li>
</ul>
<p>This is basically all there is to makefiles <em>in principle</em>. Adding a build step is as simple as
adding build targets like <code class="docutils literal notranslate"><span class="pre">build/%</span></code> depending on the source files <code class="docutils literal notranslate"><span class="pre">src/%</span></code> and changing the
<code class="docutils literal notranslate"><span class="pre">install</span></code> target to depend on the build targets instead.</p>
<h2 id="best-practices"><a class="toc-backref" href="#id7">Best Practices</a><a class="headerlink" href="#best-practices" title="Permalink to this heading">¶</a></h2>
<h3 id="default-target"><a class="toc-backref" href="#id8">Default Target</a><a class="headerlink" href="#default-target" title="Permalink to this heading">¶</a></h3>
<p>Running <code class="docutils literal notranslate"><span class="pre">make</span></code> will execute default target which is normally the first target defined.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">.DEFAULT_GOAL</span> <span class="pre">:=</span> <span class="pre">build</span></code> to define the default target.</p>
<p>See <a class="reference external" href="https://www.gnu.org/software/make/manual/html_node/Special-Variables.html#Special-Variables">https://www.gnu.org/software/make/manual/html_node/Special-Variables.html#Special-Variables</a></p>
<h3 id="install-targets"><a class="toc-backref" href="#id9">Install Targets</a><a class="headerlink" href="#install-targets" title="Permalink to this heading">¶</a></h3>
<p>Install targets should be composed of <code class="docutils literal notranslate"><span class="pre">DESTDIR</span></code> and <code class="docutils literal notranslate"><span class="pre">prefix</span></code> variables:</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><code><span class="nv">prefix</span><span class="w"> </span><span class="o">?=</span><span class="w"> </span>/usr/local
<span class="nv">bin_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">$(</span>DESTDIR<span class="k">)$(</span>prefix<span class="k">)</span>/bin
<span class="nv">i_bin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">$(</span>bin_dir<span class="k">)</span>/foo
</code></pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">DESTDIR</span></code> is typically empty but can be used to perform a staged install. Typically by system
integrators. It can also be used to build and install the software into a temporary fake
root filesystem to support simpler and more controlled software testing.
See <a class="reference external" href="https://www.gnu.org/software/make/manual/html_node/DESTDIR.html">https://www.gnu.org/software/make/manual/html_node/DESTDIR.html</a> for more.</p>
<p><code class="docutils literal notranslate"><span class="pre">prefix</span></code> is path to root filesystem subtree where the program should be installed. Defaults
to <code class="docutils literal notranslate"><span class="pre">/usr/local</span></code> as custom installed software but system integrators will override this (usually
/usr) in their packages.
See <a class="reference external" href="https://www.gnu.org/software/make/manual/html_node/Directory-Variables.html">https://www.gnu.org/software/make/manual/html_node/Directory-Variables.html</a> for more.</p>
<p>Generally the paths should be constructed in a way to respect the <code class="docutils literal notranslate"><span class="pre">Filesystem</span> <span class="pre">Hierarchy</span> <span class="pre">Standard</span>
<span class="pre">&lt;https://refspecs.linuxfoundation.org/FHS_3.0/fhs/index.html&gt;</span></code>.</p>
<p>This is an example of executable install target but other targets like documentation, data, shared
files, etc should analogously respect the relevant variables.
See <a class="reference external" href="https://www.gnu.org/software/make/manual/html_node/Directory-Variables.html">https://www.gnu.org/software/make/manual/html_node/Directory-Variables.html</a> for more make
directory variables recommendations.</p>
<h3 id="directories"><a class="toc-backref" href="#id10">Directories</a><a class="headerlink" href="#directories" title="Permalink to this heading">¶</a></h3>
<p>You may want to install directories separately for portability reasons (eg. supporting both Linux
and FreeBSD).</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><code><span class="nv">build_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>build

<span class="nf">$(build_dir)</span><span class="o">:</span>

<span class="w">  </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$@</span>

<span class="nf">$(build_dir)/%</span><span class="o">:</span><span class="w"> </span><span class="n">src</span>/%.<span class="n">bash</span> <span class="p">|</span> <span class="k">$(</span><span class="nv">build_dir</span><span class="k">)</span>

<span class="w">  </span>sed<span class="w"> </span>-e<span class="w"> </span>&lt;expression&gt;<span class="w"> </span>$&lt;<span class="w"> </span>&gt;<span class="w"> </span><span class="nv">$@</span>
</code></pre></div>
</div>
<p>How this works:</p>
<ul class="simple">
<li><p>There is a separate rule to make directories <code class="docutils literal notranslate"><span class="pre">$(build_dir)</span></code>.</p></li>
<li><p>Rules that depend on existence of the <code class="docutils literal notranslate"><span class="pre">build_dir</span></code> add it as order-only dependency to make sure the
<code class="docutils literal notranslate"><span class="pre">build_dir</span></code> is built before the rule but not cause a rebuild if the <code class="docutils literal notranslate"><span class="pre">build_dir</span></code> is newer than the
rule’s targets. See
<a class="reference external" href="https://www.gnu.org/software/make/manual/html_node/Prerequisite-Types.html#Prerequisite-Types">https://www.gnu.org/software/make/manual/html_node/Prerequisite-Types.html#Prerequisite-Types</a> for
more.</p></li>
</ul>
<h2 id="example-uses"><a class="toc-backref" href="#id11">Example Uses</a><a class="headerlink" href="#example-uses" title="Permalink to this heading">¶</a></h2>
<p>In The <a class="reference internal" href="#getting-started">Getting Started</a> section we have seen an example of installing software.</p>
<p>In similar fashion it can be used to build software or documentation. For example building manual
pages from ReST source files:</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><code><span class="nf">build/man/%.1</span><span class="o">:</span><span class="w"> </span><span class="n">man</span>/%.1.<span class="n">rst</span>

<span class="w">      </span>rst2man<span class="w"> </span>$&lt;<span class="w"> </span><span class="nv">$@</span>
</code></pre></div>
</div>
<p>It can also be used as convenient entry point to carry common tasks over the repository such as
formatting and linting:</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><code><span class="nf">.PHONY</span><span class="o">:</span><span class="w"> </span><span class="n">lint</span>
<span class="nf">lint</span><span class="o">:</span>

<span class="w">      </span>pylint<span class="w"> </span>...


<span class="nf">.PHONY</span><span class="o">:</span><span class="w"> </span><span class="n">format</span>
<span class="nf">format</span><span class="o">:</span>

<span class="w">      </span>black<span class="w"> </span>...
</code></pre></div>
</div>
<p>Or any other convenience function. If you build html files, you may want to have a convenient way to
open the browser at the built file path:</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><code><span class="nf">.PHONY</span><span class="o">:</span><span class="w"> </span><span class="n">open</span>
<span class="nf">open</span><span class="o">:</span>

<span class="w">     </span>xdg-open<span class="w"> </span>./build/index.html
</code></pre></div>
</div>
<p>Running tests:</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><code><span class="nf">.PHONY</span><span class="o">:</span><span class="w"> </span><span class="n">check</span>
<span class="nf">check</span><span class="o">:</span>

<span class="w">     </span>pytest<span class="w"> </span>...
</code></pre></div>
</div>
<p>Installing into users $HOME directory:</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><code><span class="w"> </span>.PHONY:<span class="w"> </span>install-home
<span class="nf">install-home</span><span class="o">:</span>

<span class="w">     </span><span class="k">$(</span>MAKE<span class="k">)</span><span class="w"> </span><span class="nv">prefix</span><span class="o">=</span><span class="k">$(</span>HOME<span class="k">)</span>/.local<span class="w"> </span>install-home
</code></pre></div>
</div>



  




                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../argv.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: The Ultimate Guide to Argv" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              The Ultimate Guide to Argv
            </div>
          </div>
        </a>
      
      
        
        <a href="zsh.html" class="md-footer__link md-footer__link--next" aria-label="Next: Zsh Scripting Guide" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Zsh Scripting Guide
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  
  
  <div class="md-footer-meta md-typeset">
    
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-footer-copyright__highlight">
        &#169; Copyright 2022, Jan Matějka.
        
    </div>
  
  
</div>
      
    </div>
    
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
      
        <script src="../../_static/sphinx_immaterial_theme.f9d9eeeb247ace16c.min.js"></script>
    
  </body>
</html>